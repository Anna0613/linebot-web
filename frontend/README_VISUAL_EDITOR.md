# LINE Bot 視覺化編輯器

## 概述

這是一個類似 Scratch GUI 的視覺化編程平台，專門為 LINE Bot 開發設計。使用者可以透過拖拽拼圖的方式來建立 LINE Bot 的運行邏輯，並自動生成對應的 Python 程式碼。

## 功能特色

### 🧩 拖拽式程式設計
- **直觀的拼圖介面**：類似 Scratch 的拖拽操作體驗
- **分類清晰的區塊**：依功能分為事件、訊息、邏輯、變數、LINE Bot API、範本等類別
- **即時預覽**：拖拽時提供視覺反饋，明確標示可放置區域

### 💬 完整的 LINE Bot API 支援
- **事件處理**：收到訊息、追蹤/取消追蹤、加入/離開群組等
- **訊息回覆**：文字、圖片、音訊、影片、貼圖、位置等多種訊息類型
- **主動推送**：支援推送訊息到特定用戶或群組
- **進階功能**：用戶資料取得、Rich Menu 管理、快速回覆等
- **範本訊息**：按鈕範本、輪播範本、確認範本等

### 🔧 智慧程式碼生成
- **即時生成**：區塊變更時自動生成對應的 Python 程式碼
- **符合規範**：生成的程式碼完全符合 line-bot-sdk-python 的使用規範
- **語法高亮**：提供 Python 程式碼的語法高亮顯示
- **一鍵匯出**：支援複製和下載生成的程式碼

### 💾 專案管理
- **本地儲存**：專案自動儲存到瀏覽器的 localStorage
- **匯入匯出**：支援 JSON 格式的專案匯入和匯出
- **專案結構**：提供專案的 JSON 結構預覽

## 使用方式

### 1. 存取頁面
瀏覽到 `/bots/visual-editor` 路徑即可開啟視覺化編輯器。

### 2. 拖拽操作
1. 從左側**拼圖工具區**選擇需要的區塊
2. 拖拽到中間的**工作區**
3. 雙擊區塊或點擊編輯按鈕來修改參數
4. 右側**程式碼預覽區**會即時顯示生成的程式碼

### 3. 區塊類型

#### 🎯 事件區塊 (橙色)
- **當收到訊息時**：處理用戶發送的訊息
- **當用戶追蹤時**：處理用戶追蹤 Bot 的事件
- **當 Bot 加入群組時**：處理 Bot 被加入群組的事件
- **當收到回傳資料時**：處理按鈕點擊等回傳事件

#### 💬 訊息區塊 (藍色)
- **回覆文字訊息**：回覆純文字內容
- **回覆貼圖訊息**：回覆 LINE 貼圖
- **回覆圖片訊息**：回覆圖片內容
- **推送文字訊息**：主動發送訊息給用戶

#### 🧠 邏輯區塊 (黃色)
- **如果條件**：條件判斷邏輯
- **設定變數**：變數賦值操作

#### 🔮 LINE Bot API 區塊 (紫色)
- **取得用戶資料**：獲取用戶的個人資料
- **建立快速回覆**：建立快速回覆選項

#### 📋 範本訊息區塊 (青色)
- **回覆按鈕範本**：建立包含按鈕的範本訊息

### 4. 程式碼匯出
- 點擊右上角的**匯出程式碼**按鈕
- 或使用程式碼預覽區的複製/下載功能
- 生成的程式碼可直接用於 LINE Bot 開發

## 技術架構

### 前端技術棧
- **React 18** + **TypeScript**：現代化的前端框架
- **Vite**：快速的建構工具
- **Tailwind CSS** + **Radix UI**：美觀且無障礙的 UI 組件
- **@dnd-kit**：強大的拖拽功能庫
- **Zustand**：輕量級狀態管理
- **react-syntax-highlighter**：程式碼語法高亮

### 核心組件
- **VisualBotEditor**：主編輯器容器
- **BlockPalette**：拼圖工具區，提供可拖拽的區塊
- **Workspace**：工作區，接收拖拽的區塊
- **BlockRenderer**：區塊渲染器，處理區塊的顯示和編輯
- **CodePreview**：程式碼預覽區，顯示生成的 Python 程式碼

### 狀態管理
使用 Zustand 管理應用狀態，包括：
- 工作區區塊狀態
- 拖拽狀態
- 程式碼生成狀態
- 專案管理狀態

## 區塊定義系統

每個區塊都包含以下屬性：
- **id**：唯一識別碼
- **type**：區塊類型
- **category**：所屬類別
- **label**：顯示名稱
- **color**：區塊顏色
- **shape**：區塊形狀 (hat/statement/expression/cap)
- **fields**：可編輯的欄位
- **code**：對應的 Python 程式碼範本

## 程式碼生成機制

1. **監聽狀態變化**：當工作區區塊發生變化時觸發程式碼生成
2. **區塊排序**：按照區塊類型和邏輯順序排列
3. **範本替換**：將區塊的欄位值替換到程式碼範本中
4. **程式碼組合**：將所有區塊的程式碼組合成完整的 Python 檔案
5. **即時更新**：更新程式碼預覽區的顯示

## 擴展性

### 新增區塊類型
1. 在 `blockDefinitions.ts` 中定義新的區塊
2. 指定區塊的屬性和程式碼範本
3. 系統會自動加載並顯示新區塊

### 自訂程式碼生成
修改 `visualEditorStore.ts` 中的 `generateCode` 函數來自訂程式碼生成邏輯。

## 瀏覽器支援

支援所有現代瀏覽器：
- Chrome 88+
- Firefox 85+
- Safari 14+
- Edge 88+

## 已知限制

1. **區塊連接**：目前版本尚未實作區塊間的視覺化連接線
2. **測試功能**：內建測試環境尚未實作
3. **複雜邏輯**：對於非常複雜的程式邏輯，建議直接撰寫程式碼

## 未來規劃

- [ ] 區塊間的視覺化連接系統
- [ ] 內建測試環境
- [ ] 更多 LINE Bot API 支援
- [ ] 範本專案庫
- [ ] 協作功能
- [ ] 行動版介面優化

## 程式碼範例

使用視覺化編輯器生成的典型 LINE Bot 程式碼：

```python
from linebot.v3.messaging import *
from linebot.v3.webhooks import *
import os

# LINE Bot 設定
line_bot_api = MessagingApi(
    api_client=ApiClient(
        configuration=Configuration(
            access_token=os.getenv('LINE_CHANNEL_ACCESS_TOKEN')
        )
    )
)

def handle_message(event):
    \"\"\"處理訊息事件\"\"\"
    if isinstance(event, MessageEvent):
        if event.message.text == "你好":
            line_bot_api.reply_message(
                ReplyMessageRequest(
                    reply_token=event.reply_token, 
                    messages=[TextMessage(text="您好！歡迎使用 LINE Bot")]
                )
            )
```

這個範例展示了如何使用拖拽的方式建立一個簡單的問候 Bot。