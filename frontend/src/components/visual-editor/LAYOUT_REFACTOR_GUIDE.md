# Visual Editor 佈局重構指南

## 重構目標
將邏輯模板和FlexMessage選擇器從頂層導航欄移動到對應的標籤頁下方，讓界面更簡潔且符合使用邏輯。

## 重構前後對比

### 重構前
```
頂層導航欄:
├── Bot選擇器
├── 邏輯模板選擇器 (總是顯示)
├── FlexMessage選擇器 (總是顯示)
└── 專案管理功能

標籤頁:
├── 邏輯編輯器
├── Flex設計器
├── 預覽與測試
└── 程式碼
```

### 重構後
```
頂層導航欄:
├── Bot選擇器
└── 專案管理功能 (匯入/匯出/儲存/測試)

標籤頁:
├── 邏輯編輯器
│   ├── 邏輯模板選擇器 (只在此標籤頁顯示)
│   └── 積木編輯區域
├── Flex設計器
│   ├── FlexMessage選擇器 (只在此標籤頁顯示)
│   └── 設計與預覽區域
├── 預覽與測試
└── 程式碼
```

## 實作的組件

### 1. LogicTemplateSelector 組件
- **位置**: `/src/components/visual-editor/LogicTemplateSelector.tsx`
- **功能**: 邏輯模板的選擇、創建、儲存
- **特色**:
  - 只在有Bot被選擇時顯示
  - 包含創建新邏輯模板的功能
  - 即時顯示邏輯模板啟用狀態
  - 具備錯誤處理和成功提示

### 2. FlexMessageSelector 組件
- **位置**: `/src/components/visual-editor/FlexMessageSelector.tsx`
- **功能**: FlexMessage的選擇、創建、儲存
- **特色**:
  - 獨立於Bot選擇器，全域管理FlexMessage
  - 包含創建新FlexMessage的功能
  - 具備錯誤處理和成功提示

### 3. ProjectManager 組件 (簡化版)
- **修改**: 移除了邏輯模板和FlexMessage相關功能
- **保留功能**:
  - Bot選擇器
  - 專案匯入/匯出
  - 專案儲存到資料庫
  - 測試功能
- **界面**: 更簡潔的單行佈局

### 4. Workspace 組件 (增強版)
- **新增**: 整合了LogicTemplateSelector和FlexMessageSelector
- **邏輯編輯器標籤頁**:
  - 頂部顯示LogicTemplateSelector (當有Bot被選擇時)
  - 下方為積木編輯區域
- **Flex設計器標籤頁**:
  - 頂部顯示FlexMessageSelector
  - 下方為設計和預覽區域

### 5. VisualBotEditor 組件 (更新Props)
- **修改**: 調整了props傳遞邏輯
- **ProjectManager**: 移除了邏輯模板和FlexMessage相關props
- **Workspace**: 新增了邏輯模板和FlexMessage管理相關props

## 使用者體驗改進

### 1. 界面簡潔度
- 頂層導航欄只保留必要的Bot選擇和專案管理功能
- 減少了界面混亂，提高了可讀性
- 相關功能就近放置，符合使用邏輯

### 2. 工作流程優化
- 用戶首先選擇Bot
- 切換到邏輯編輯器時才看到邏輯模板選擇器
- 切換到Flex設計器時才看到FlexMessage選擇器
- 避免了不相關功能的干擾

### 3. 視覺層次
- 清楚的功能分層：Bot → 工作區 → 模板/訊息
- 條件式顯示減少認知負荷
- 更好的空間利用

## 技術實作要點

### 1. 組件分離
- 將複雜的ProjectManager拆分為專門的選擇器組件
- 每個組件負責特定的功能領域
- 提高了代碼的可維護性和重用性

### 2. Props傳遞優化
- 簡化了ProjectManager的props介面
- 將相關功能的props集中傳遞給Workspace
- 保持了組件間的清晰職責分工

### 3. 條件式渲染
- LogicTemplateSelector只在有Bot被選擇時顯示
- FlexMessageSelector在Flex設計器標籤頁顯示
- 避免了不必要的API請求和界面混亂

### 4. 狀態管理
- 保持了原有的狀態管理邏輯
- 確保數據流的一致性
- 維持了組件間的正確通信

## 保持的功能

### 1. 完整的CRUD操作
- 創建、讀取、更新邏輯模板和FlexMessage
- 錯誤處理和用戶反饋
- 數據持久化和同步

### 2. 用戶體驗特性
- 載入狀態指示
- 成功和錯誤提示
- 表單驗證
- 鍵盤快捷鍵支援

### 3. 數據完整性
- 自動載入相關數據
- 切換時的數據同步
- 兼容舊版數據格式

## 未來擴展建議

### 1. 快捷操作
- 在標籤頁標題中新增快速切換按鈕
- 鍵盤快捷鍵支援
- 拖拽功能增強

### 2. 批次操作
- 多選邏輯模板進行批次操作
- 複製模板到其他Bot
- 匯出/匯入單個模板或訊息

### 3. 視覺化改進
- 預覽縮圖
- 標籤頁圖示
- 更豐富的狀態指示器

這次重構成功地改善了用戶界面的組織結構，讓功能更加直觀和易用，同時保持了所有原有功能的完整性。